html
  head
    -
      var cspContent = `
        default-src 'none';
        img-src ${cspSource} https:;
        style-src 'unsafe-inline' https://cdn.jsdelivr.net ${cspSource} https://cdnjs.cloudflare.com;
        script-src 'unsafe-inline' https://cdn.jsdelivr.net ${cspSource};
      `;
    meta(http-equiv="Content-Security-Policy",  content=cspContent)
    link(href!=styleURI, rel="stylesheet")
    link(rel="stylesheet", href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css", media="screen and (prefers-color-scheme: dark)")
    link(rel="stylesheet", type="text/css", href="https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css")
    script(src="https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js")
  body

    - var false_positive_reason = vulnerability.issue?.false_positive?.reasoning || ''
    h1
      img(src!=logoURI, alt="Logo", width="50")
      a(href!=`command:vscode.open?${encodeURIComponent(JSON.stringify(fileURI))}`) !{vulnerability.issue.file_path}: !{vulnerability.issue.line_num}
    strong
      span(class=`${vulnerability.issue.urgency} severity`) !{vulnerability.issue.urgency}
    | !{vulnerability.issue.classification}
    hr
    a(href=`command:vscode.open?${corgeaURI}`)
      button.btn-secondary.mr-2 See on Corgea
    if vulnerability.issue.on_hold
      .card
        .card-header Could Not Issue Fix
        if vulnerability.issue.hold_reason === "language"
          .card-body
            p.fix_explanation Corgea currently does not support this language.
        else if vulnerability.issue.hold_reason === "plan"
          .card-body
            p.fix_explanation You've reached the limit of your plan. Please upgrade to get all the fixes.
        else if vulnerability.issue.hold_reason === "false_positive"
          .card-body
            p.fix_explanation
              h3 False Positive Detected
              | !{false_positive_reason}
        else if vulnerability.issue.hold_reason === "gpt_error"
          .card-body
            p.fix_explanation Corgea was unable to generate a fix for this issue. This was likely due to insufficient context or failing QA checks.
        else
          .card-body
            p.fix_explanation Corgea was unable to generate a fix for this issue due to AI limitations.
    else
      if vulnerability.fix.diff
        button.btn-primary(onclick="applyDiff()") Apply Fix
        br
        br
        #diffElement
        br
        br
        .card
          .card-header Issue Explanation
          .card-body
            p.issue_explanation !{vulnerability.issue.explanation}
        br
        .card
          .card-header Fix Explanation
          .card-body
            p.fix_explanation !{vulnerability.fix.explanation}

        script.
          const diffString = `!{JSON.stringify(diffString)}`;
          document.addEventListener('DOMContentLoaded', function () {
            var targetElement = document.getElementById('diffElement');
            const configuration = { drawFileList: true, matching: 'lines', highlight: true, outputFormat: 'side-by-side', colorScheme: 'dark' };
            var diff2htmlUi = new Diff2HtmlUI(targetElement, diffString, configuration);
            diff2htmlUi.draw();
            diff2htmlUi.highlightCode();
          });

          const vscode = acquireVsCodeApi();

          function applyDiff() {
            const diff = diffString;
            vscode.postMessage({
                command: 'applyDiff',
                fileUri: `!{fileURI.scheme}:!{fileURI.path}#!{fileURI.fragment}`,
                diff: diff
            });
          }
      else
        .card
          .card-header Fix In Progress
          .card-body
            p.fix_explanation Corgea is processing the issue and will create a fix soon. Please check again later.
